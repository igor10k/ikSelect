// ikSelect 0.8.1
// Copyright (c) 2012 Igor Kozlov
// i10k.ru

;(function($,p,q,r){var s=$(p);var t={syntax:'<div class="ik_select_link"><span class="ik_select_link_text"></span></div><div class="ik_select_block"><div class="ik_select_list"></div></div>',autoWidth:true,ddFullWidth:true,customClass:"",ddCustomClass:"",ddMaxHeight:200};var u=$([]);var v=false;var w=-1;$.browser.mobile=(/iphone|ipad|ipod|android/i.test(navigator.userAgent.toLowerCase()));$.browser.android=(/android/i.test(navigator.userAgent.toLowerCase()));$.browser.operamini=Object.prototype.toString.call(p.operamini)==="[object OperaMini]";function IkSelect(a,b){var c=this;c.element=a;c.options=$.extend({},t,b);c._defaults=t;c._name='ikSelect';if(c.element===r){return c}c.fakeSelect=$('<div class="ik_select">'+c.options.syntax+'</div>');c.select=$(c.element);c.link=$(".ik_select_link",c.fakeSelect);c.linkText=$(".ik_select_link_text",c.fakeSelect);c.block=$(".ik_select_block",c.fakeSelect);c.list=$(".ik_select_list",c.fakeSelect);c.listInner=$('<div class="ik_select_list_inner"/>');c.active=$([]);c.hover=$([]);c.init()}$.extend(IkSelect.prototype,{init:function(){var h=this;var i=h.fakeSelect;var j=h.select;var k=h.link;var l=h.linkText;var m=h.block;var n=h.list;var o=h.listInner;n.append(o);i.addClass(h.options.customClass);m.addClass(h.options.ddCustomClass);h.reset();if(j.attr("disabled")){h.disable_select()}k.bind("click.ikSelect",function(){if(i.data("ik_select_disabled")){return this}if(u.length){u.data("plugin_ikSelect").hide_block()}if(!$.browser.mobile){h.show_block()}j.focus()});j.bind("focus.ikSelect",function(){if(i.data("ik_select_disabled")){return this}k.addClass("ik_select_focus");if((i.offset().top+i.height()>s.scrollTop()+s.height())||(i.offset().top+i.height()<s.scrollTop())){s.scrollTop(i.offset().top-s.height()/2)}});j.bind("blur.ikSelect",function(){if(i.data("ik_select_disabled")){return this}k.removeClass("ik_select_focus")});j.bind("change.ikSelect",function(a){h._select_fake_option()});j.bind("keydown.ikSelect keyup.ikSelect",function(a){var b=a.which;var c=h.active;var d=h.hover;var e=a.type;switch(b){case 40:if(e==="keydown"){a.preventDefault();var f;if(d.next("li").length){f=d.next("li");while(f.hasClass("ik_select_option_disabled")){f=f.next()}}if((!f||!f.length)&&d.parents(".ik_select_optgroup").next().length){f=d.parents(".ik_select_optgroup").next();while(f.length&&!f.find("li:not(.ik_select_option_disabled)").length){f=f.next()}f=f.find("li:not(.ik_select_option_disabled):first")}if(f&&f.length){h._move_to(f)}}break;case 38:if(e==="keydown"){a.preventDefault();var g;if(d.prev("li").length){g=d.prev("li");while(g.hasClass("ik_select_option_disabled")){g=g.prev()}}if((!g||!g.length)&&d.parents(".ik_select_optgroup").prev().length){g=d.parents(".ik_select_optgroup").prev();while(g.length&&!g.find("li:not(.ik_select_option_disabled)").length){g=g.prev()}g=g.find("li:last")}if(g&&g.length){h._move_to(g)}}break;case 33:case 36:if(e==="keydown"){a.preventDefault();h._move_to($("li:first",n))}break;case 34:case 35:if(e==="keydown"){a.preventDefault();h._move_to($("li:last",n))}break;case 32:if(e==="keydown"){a.preventDefault();if(!m.is(":visible")){h.show_block()}else{h._select_real_option()}}break;case 13:if(e==="keydown"&&m.is(":visible")){a.preventDefault();h._select_real_option()}break;case 27:if(e==="keydown"){a.preventDefault();h.hide_block()}break;case 9:if(e==="keydown"){if($.browser.webkit&&m.is(":visible")){a.preventDefault()}else{h.hide_block()}}break;default:if(e==="keyup"){h._select_fake_option()}break}});j.after(i);h.redraw();j.prependTo(i);m.data("ik_select_block_left",m.css("left"));m.data("ik_select_block_top",m.css("top"))},redraw:function(){var a=this;var b=a.select;var c=a.fakeSelect;var d=a.block;var e=a.list;var f=a.listInner;var g=a.options.autoWidth;var h=a.options.ddFullWidth;if(g||h){f.width("auto");$("ul",f).width("auto");c.width("auto");d.show().width(9999);f.css("float","left");e.css("position","absolute");var i=e.outerWidth(true);var j=e.width();e.css("position","static");d.hide().css("width","100%");f.css("float","none");if(w===-1){var k=$('<div style="width:50px;height:50px;overflow:hidden;position:absolute;top:-200px;left:-200px;"><div style="height:100px;"></div>');$("body").append(k);var l=$("div",k).innerWidth();k.css("overflow","auto");var m=$("div",k).innerWidth();$(k).remove();w=l-m}var n=c.parent().width();if(h){d.width(i);f.width(j);$("ul",f).width(j)}if(i>n){i=n}if(g){c.width(i)}}a._fix_height();if(!$.browser.mobile){b.width(1);b.css({left:-9999,top:0,height:c.height()})}},reset:function(){var a=this;var b=a.select;var c=a.linkText;var d=a.listInner;c.html(b.html());d.empty();var e='';var f=$("optgroup",b);if(f.length){f.each(function(){e+='<div class="ik_select_optgroup'+($(this).is(":disabled")?" ik_select_optgroup_disabled":"")+'">';e+='<div class="ik_select_optgroup_label">'+$(this).attr("label")+'</div>';e+='<ul>';$("option",this).each(function(){e+='<li'+($(this).is(":disabled")?" class=\"ik_select_option_disabled\"":"")+'><span class="ik_select_option" title="'+$(this).val()+'">'+$(this).html()+'</span></li>'});e+='</ul>';e+='</div>'})}else{e+='<ul>';$("option",b).each(function(){e+='<li'+($(this).is(":disabled")?" class=\"ik_select_option_disabled\"":"")+'><span class="ik_select_option" title="'+$(this).val()+'">'+$(this).html()+'</span></li>'});e+='</ul>'}d.append(e);a._select_fake_option();a._attach_list_events($("li:not(.ik_select_option_disabled)",d))},_attach_list_events:function(a){var b=this;var c=b.select;var d=b.linkText;var e=b.list;a.bind("click.ikSelect",function(){d.html($(".ik_select_option",this).html());c.val($(".ik_select_option",this).attr("title"));b.active.removeClass("ik_select_active");b.active=$(this).addClass("ik_select_active");b.hide_block();c.change();c.focus()});a.bind("mouseover.ikSelect",function(){b.hover.removeClass("ik_select_hover");b.hover=$(this).addClass("ik_select_hover")});a.addClass("ik_select_has_events")},_detach_list_events:function(a){a.unbind(".ikSelect");a.removeClass("ik_select_has_events")},set_defaults:function(a){$.extend(this._defaults,a||{});return this},hide_block:function(){var a=this.fakeSelect;var b=this.block;var c=this.select;b.hide().appendTo(a).css({"left":b.data("ik_select_block_left"),"top":b.data("ik_select_block_top")});u=$([]);c.focus()},show_block:function(){var a=this;var b=a.select;if($.browser.mobile&&!$.browser.android){b.focus();return a}if(u.is(a.select)){return a}else if(u.length){u.data("plugin_ikSelect").hide_block()}var c=a.fakeSelect;var d=a.block;var e=a.list;var f=a.listInner;var g=a.hover;var h=a.active;d.show();var i=$("option",b).index($("option:selected",b));g.removeClass("ik_select_hover");h.removeClass("ik_select_active");var j=$("li:eq("+i+")",e);j.addClass("ik_select_hover ik_select_active");a.hover=j;a.active=j;d.removeClass("ik_select_block_right");d.css("left",d.data("ik_select_block_left"));if(a.options.ddFullWidth&&c.offset().left+d.outerWidth(true)>s.width()){d.addClass("ik_select_block_right");d.css("left",(d.offset().left+d.outerWidth(true)-s.width())*(-1))}d.removeClass("ik_select_block_up");d.css("top",d.data("ik_select_block_top"));if(d.offset().top+d.outerHeight(true)>s.scrollTop()+s.height()){d.addClass("ik_select_block_up");d.css("top",((d.offset().top+d.outerHeight(true)-parseInt(d.data("ik_select_block_top"),10))-(s.scrollTop()+s.height()))*(-1))}var k=d.offset().left;var l=d.offset().top;d.width(d.width());d.appendTo("body").css({"left":k,"top":l});var m=$(".ik_select_active",e).position().top-e.height()/2;e.data("ik_select_scrollTop",m);f.scrollTop(m);u=b},add_options:function(h){var i=this;var j=i.select;var k=i.list;var l=i.listInner;var m='',selectHtml='';$.each(h,function(c,d){if(typeof d==='string'){m+='<li><span class="ik_select_option" title="'+c+'">'+d+'</span></li>';selectHtml+='<option value="'+c+'">'+d+'</option>'}else if(typeof d==='object'){var e=$("ul:eq("+c+")",k);var f=$("optgroup:eq("+c+")",j);var g=d;$.each(g,function(a,b){m+='<li><span class="ik_select_option" title="'+a+'">'+b+'</span></li>';selectHtml+='<option value="'+a+'">'+b+'</option>'});e.append(m);f.append(selectHtml);m='';selectHtml=''}});if(selectHtml!==''){$(":first",l).append(m);j.append(selectHtml)}i._fix_height();i._attach_list_events($("li:not(.ik_select_has_events)",l))},remove_options:function(d){var e=this;var f=e.select;var g=e.list;var h=$([]);$.each(d,function(b,c){$("option",f).each(function(a){if($(this).val()===c){h=h.add($(this)).add($("li:eq("+a+")",g))}})});h.remove();e._select_fake_option();e._fix_height()},_select_real_option:function(){var a=this.hover;var b=this.active;b.removeClass("ik_select_active");a.addClass("ik_select_active").click()},_select_fake_option:function(){var a=this;var b=a.select;var c=a.list;var d=a.linkText;var e=$(":selected",b);var f=$("option",b).index(e);d.html(e.html());a.hover=$("li",c).removeClass("ik_select_hover ik_select_active").eq(f).addClass("ik_select_hover ik_select_active");a.active=a.hover},disable_select:function(){var a=this.fakeSelect;var b=this.select;b.attr("disabled","disabled");a.addClass("ik_select_disabled").data("ik_select_disabled",true)},enable_select:function(){var a=this.fakeSelect;var b=this.select;b.removeAttr("disabled");a.removeClass("ik_select_disabled").data("ik_select_disabled",false)},toggle_select:function(){var a=this;var b=a.fakeSelect;if(b.data("ik_select_disabled")){a.enable_select()}else{a.disable_select()}},make_selection:function(a){var b=this;var c=b.select;c.val(a);b._select_fake_option()},disable_optgroups:function(d){var e=this;var f=e.select;var g=e.list;$.each(d,function(a,b){var c=$("optgroup:eq("+b+")",f);c.attr("disabled","disabled");$(".ik_select_optgroup:eq("+b+")",g).addClass("ik_select_optgroup_disabled");e.disable_options($("option",c))});e._select_fake_option()},enable_optgroups:function(d){var e=this;var f=e.select;var g=e.list;$.each(d,function(a,b){var c=$("optgroup:eq("+b+")",f);c.removeAttr("disabled");$(".ik_select_optgroup:eq("+b+")",g).removeClass("ik_select_optgroup_disabled");e.enable_options($("option",c))});e._select_fake_option()},disable_options:function(g){var h=this;var i=h.select;var j=h.list;var k=$("option",i);$.each(g,function(c,d){if(typeof d==="object"){$(this).attr("disabled","disabled");var e=k.index(this);var f=$("li:eq("+e+")",j).addClass("ik_select_option_disabled");h._detach_list_events(f)}else{k.each(function(a){if($(this).val()===d){$(this).attr("disabled","disabled");var b=$("li:eq("+a+")",j).addClass("ik_select_option_disabled");h._detach_list_events(b);return this}})}});h._select_fake_option()},enable_options:function(g){var h=this;var i=h.select;var j=h.list;var k=$("option",i);$.each(g,function(c,d){if(typeof d==="object"){$(this).removeAttr("disabled");var e=k.index(this);var f=$("li:eq("+e+")",j).removeClass("ik_select_option_disabled");h._attach_list_events(f)}else{k.each(function(a){if($(this).val()===d){$(this).removeAttr("disabled");var b=$("li:eq("+a+")",j).removeClass("ik_select_option_disabled");h._attach_list_events(b);return this}})}});h._select_fake_option()},detach_plugin:function(){var a=this;var b=a.select;var c=a.fakeSelect;b.unbind(".ikSelect").css({"width":"","height":"","left":"","top":""});c.before(b);c.remove()},_move_to:function(a){var b=this;var c=b.select;var d=b.block;var e=b.linkText;if(!d.is(":visible")&&$.browser.webkit){b.show_block();return this}b.hover.removeClass("ik_select_hover");a.addClass("ik_select_hover");b.hover=a;if(!$.browser.webkit){b.active.removeClass("ik_select_active");a.addClass("ik_select_active");b.active=a}if(!d.is(":visible")||$.browser.mozilla){if(!$.browser.mozilla){c.val($(".ik_select_option",a).attr("title"));c.change()}e.html($(".ik_select_option",a).html())}},_fix_height:function(){var a=this;var b=a.block;var c=a.listInner;var d=a.options.ddMaxHeight;var e=a.options.ddFullWidth;b.show();c.css("height","auto");if(c.height()>d){c.css({overflow:"auto",height:d,position:"relative"});if(!$.data(c,"ik_select_hasScrollbar")){if(e){b.width(b.width()+w);c.width(c.width()+w)}}$.data(c,"ik_select_hasScrollbar",true)}else{if($.data(c,"ik_select_hasScrollbar")){c.css({overflow:"",height:"auto"});c.width(c.width()-w);b.width(b.width()-w)}}b.hide()}});$.fn.ikSelect=function(b){if($.browser.operamini){return this}var c=Array.prototype.slice.call(arguments);return this.each(function(){if(!$.data(this,'plugin_ikSelect')){$.data(this,'plugin_ikSelect',new IkSelect(this,b))}else if(typeof b==='string'){var a=$.data(this,'plugin_ikSelect');switch(b){case'reset':a.reset();break;case'hide_dropdown':a.hide_block();break;case'show_dropdown':v=true;a.show_block();break;case'add_options':a.add_options(c[1]);break;case'remove_options':a.remove_options(c[1]);break;case'enable':a.enable_select();break;case'disable':a.disable_select();break;case'toggle':a.toggle_select();break;case'select':a.make_selection(c[1]);break;case'set_defaults':a.set_defaults(c[1]);break;case'redraw':a.redraw();break;case'disable_options':a.disable_options(c[1]);break;case'enable_options':a.enable_options(c[1]);break;case'disable_optgroups':a.disable_optgroups(c[1]);break;case'enable_optgroups':a.enable_optgroups(c[1]);break;case'detach':a.detach_plugin();break}}})};$.ikSelect=new IkSelect();$(q).bind("click.ikSelect",function(a){if(!v&&u.length&&!$(a.target).parents(".ik_select").length){u.ikSelect("hide_dropdown");u=$([])}if(v){v=false}})})(jQuery,window,document);