// ikSelect 0.6.3
// Copyright (c) 2012 Igor Kozlov
// i10k.ru
(function(a,b,c){function m(b,d){var e=this;e.element=b,e.options=a.extend({},f,d),e._defaults=f,e._name="ikSelect";if(e.element===c)return e;e.fakeSelect=a('<div class="ik_select">'+e.options.syntax+"</div>"),e.select=a(e.element),e.link=a(".ik_select_link",e.fakeSelect),e.linkText=a(".ik_select_link_text",e.fakeSelect),e.block=a(".ik_select_block",e.fakeSelect),e.list=a(".ik_select_list",e.fakeSelect),e.listInner=a('<div class="ik_select_list_inner"/>'),e.active=a([]),e.hover=a([]),e.init()}var d=b.document,e=a(b),f={syntax:'<div class="ik_select_link"><span class="ik_select_link_text"></span></div><div class="ik_select_block"><div class="ik_select_list"></div></div>',autoWidth:!0,ddFullWidth:!0,customClass:"",maxHeight:200},g=a([]),h=!1,i=-1,j=/iphone|ipad|ipod|android/i.test(navigator.userAgent.toLowerCase()),k=/android/i.test(navigator.userAgent.toLowerCase()),l={}.toString.call(b.operamini)==="[object OperaMini]";a.extend(m.prototype,{init:function(){var b=this,c=b.options.autoWidth,d=b.options.ddFullWidth,f=b.fakeSelect,h=b.select,k=b.link,l=b.linkText,m=b.block,n=b.list,o=b.listInner;n.append(o),f.addClass(b.options.customClass),b.reset(),h.attr("disabled")&&b.disable_select(),k.bind("click.ikSelect",function(){if(f.data("ik_select_disabled"))return this;g.length&&g.data("plugin_ikSelect").hide_block(),j||b.show_block(),h.focus()}),h.bind("focus.ikSelect",function(){if(f.data("ik_select_disabled"))return this;k.addClass("ik_select_focus"),f.offset().top+f.height()>e.scrollTop()+e.height()&&e.scrollTop(f.offset().top-e.height()/2)}),h.bind("blur.ikSelect",function(){if(f.data("ik_select_disabled"))return this;k.removeClass("ik_select_focus")}),h.bind("change.ikSelect",function(a){a.preventDefault(),b._select_fake_option()}),h.bind("keydown.ikSelect keyup.ikSelect",function(c){var d=c.which,e=b.active,f=b.hover,g=c.type;switch(d){case 40:if(g==="keydown"){c.preventDefault();var i;f.next("li").length?i=f.next("li"):f.parents(".ik_select_optgroup").next().length&&(i=f.parents(".ik_select_optgroup").next().find("li:first")),i&&i.length&&b._move_to(i)}g==="keyup"&&(!m.is(":visible")||a.browser.mozilla)&&h.val(a(".ik_select_option",b.hover).attr("title"));break;case 38:if(g==="keydown"){c.preventDefault();var j;f.prev("li").length?j=f.prev("li"):f.parents(".ik_select_optgroup").prev().length&&(j=f.parents(".ik_select_optgroup").prev().find("li:last")),j&&j.length&&b._move_to(j)}g==="keyup"&&(!m.is(":visible")||a.browser.mozilla)&&h.val(a(".ik_select_option",b.hover).attr("title"));break;case 33:case 36:g==="keydown"&&(c.preventDefault(),b._move_to(a("li:first",n)));break;case 34:case 35:g==="keydown"&&(c.preventDefault(),b._move_to(a("li:last",n)));break;case 32:g==="keydown"&&(c.preventDefault(),m.is(":visible")?b._select_real_option():b.show_block());break;case 13:g==="keydown"&&m.is(":visible")&&(c.preventDefault(),b._select_real_option());break;case 27:g==="keydown"&&(c.preventDefault(),b.hide_block());break;case 9:g==="keydown"&&b.hide_block();break;default:g==="keyup"&&b._select_fake_option()}}),h.after(f);if(c||d){m.show().width(9999),o.css("float","left"),n.css("position","absolute");var p=n.outerWidth(!0),q=n.width();n.css("position","static"),m.hide().css("width","100%"),o.css("float","none");if(i===-1){var r=a('<div style="width:50px;height:50px;overflow:hidden;position:absolute;top:-200px;left:-200px;"><div style="height:100px;"></div>');a("body").append(r);var s=a("div",r).innerWidth();r.css("overflow-y","scroll");var t=a("div",r).innerWidth();a(r).remove(),i=s-t}var u=h.parent().width();d&&(m.width(p),o.width(q),a("ul",o).width(q)),p>u&&(p=u),c&&f.width(p)}b._fix_height(),j||(h.width(1),h.css({left:-9999,top:0,height:f.height()})),h.prependTo(f),m.data("ik_select_block_left",m.css("left")),m.data("ik_select_block_top",m.css("top"))},reset:function(){var b=this,c=b.select,d=b.linkText,e=b.listInner;d.html(c.html()),e.empty();var f="",g=a("optgroup",c);g.length?g.each(function(){f+='<div class="ik_select_optgroup">',f+='<div class="ik_select_optgroup_label">'+a(this).attr("label")+"</div>",f+="<ul>",a("option",this).each(function(){f+='<li><span class="ik_select_option" title="'+a(this).val()+'">'+a(this).html()+"</span></li>"}),f+="</ul>",f+="</div>"}):(f+="<ul>",a("option",c).each(function(){f+='<li><span class="ik_select_option" title="'+a(this).val()+'">'+a(this).html()+"</span></li>"}),f+="</ul>"),e.append(f),b._select_fake_option(),b._attach_list_events(a("li",e))},_attach_list_events:function(b){var c=this,d=c.select,e=c.linkText,f=c.list;b.bind("click.ikSelect",function(){e.html(a(".ik_select_option",this).html()),d.val(a(".ik_select_option",this).attr("title")),c.active.removeClass("ik_select_active"),c.active=a(this).addClass("ik_select_active"),c.hide_block(),d.focus()}),b.bind("mouseover.ikSelect",function(){c.hover.removeClass("ik_select_hover"),c.hover=a(this),a(this).addClass("ik_select_hover")}),b.addClass("ik_select_has_events")},set_defaults:function(b){return a.extend(this._defaults,b||{}),this},hide_block:function(){var b=this.fakeSelect,c=this.block,d=this.select;c.hide().appendTo(b).css({left:c.data("ik_select_block_left"),top:c.data("ik_select_block_top")}),g=a([]),d.focus()},show_block:function(){var b=this,c=b.select;if(j&&!k)return c.focus(),b;var d=b.fakeSelect,f=b.block,h=b.list,i=b.listInner,l=b.hover,m=b.active;f.show();var n=a("option",c).index(a("option:selected",c));l.removeClass("ik_select_hover"),m.removeClass("ik_select_active");var o=a("li:eq("+n+")",h);o.addClass("ik_select_hover ik_select_active"),b.hover=o,b.active=o,f.removeClass("ik_select_block_right"),f.css("left",f.data("ik_select_block_left")),b.options.ddFullWidth&&d.offset().left+f.outerWidth(!0)>e.width()&&(f.addClass("ik_select_block_right"),f.css("left",(f.offset().left+f.outerWidth(!0)-e.width())*-1)),f.removeClass("ik_select_block_up"),f.css("top",f.data("ik_select_block_top")),f.offset().top+f.outerHeight(!0)>e.scrollTop()+e.height()&&(f.addClass("ik_select_block_up"),f.css("top",(f.offset().top+f.outerHeight(!0)-parseInt(f.data("ik_select_block_top"),10)-(e.scrollTop()+e.height()))*-1));var p=f.offset().left,q=f.offset().top;f.width(f.width()),f.appendTo("body").css({left:p,top:q});var r=a(".ik_select_active",h).position().top-h.height()/2;h.data("ik_select_scrollTop",r),i.scrollTop(r),g=c},add_options:function(b){var c=this,d=c.select,e=c.list,f=c.listInner,g="",h="";a.each(b,function(b,c){if(typeof c=="string")g+='<li><span class="ik_select_option" title="'+b+'">'+c+"</span></li>",h+='<option value="'+b+'">'+c+"</option>";else if(typeof c=="object"){var f=a("ul:eq("+b+")",e),i=a("optgroup:eq("+b+")",d),j=c;a.each(j,function(a,b){g+='<li><span class="ik_select_option" title="'+a+'">'+b+"</span></li>",h+='<option value="'+a+'">'+b+"</option>"}),f.append(g),i.append(h),g="",h=""}}),h!==""&&(a(":first",f).append(g),d.append(h)),c._fix_height(),c._attach_list_events(a("li:not(.ik_select_has_events)",f))},remove_options:function(b){var c=this,d=c.select,e=c.list,f=a([]);a.each(b,function(b,c){a("option",d).each(function(b){a(this).val()===c&&(f=f.add(a(this)).add(a("li:eq("+b+")",e)))})}),f.remove(),c._select_fake_option(),c._fix_height()},_select_real_option:function(){var a=this.hover,b=this.active;b.removeClass("ik_select_active"),a.addClass("ik_select_active").click()},_select_fake_option:function(){var b=this.select,c=this.list,d=this.linkText,e=a(":selected",b),f=a("option",b).index(e);d.html(e.html()),a("li",c).removeClass("ik_select_hover").eq(f).addClass("ik_select_hover")},disable_select:function(){var a=this.fakeSelect,b=this.select;b.attr("disabled","disabled"),a.addClass("ik_select_disabled").data("ik_select_disabled",!0)},enable_select:function(){var a=this.fakeSelect,b=this.select;b.removeAttr("disabled"),a.removeClass("ik_select_disabled").data("ik_select_disabled",!1)},toggle_select:function(){var a=this,b=a.fakeSelect;b.data("ik_select_disabled")?a.enable_select():a.disable_select()},make_selection:function(a){var b=this,c=b.select;c.val(a),b._select_fake_option()},_move_to:function(b){var c=this,d=c.block,e=c.linkText;c.hover.removeClass("ik_select_hover"),b.addClass("ik_select_hover"),c.hover=b,a.browser.mozilla&&(c.active.removeClass("ik_select_active"),b.addClass("ik_select_active"),c.active=b),(!d.is(":visible")||a.browser.mozilla)&&e.html(a(".ik_select_option",b).html())},_fix_height:function(){var b=this,c=b.block,d=b.listInner,e=b.options.maxHeight,f=b.options.ddFullWidth;c.show(),d.height()>e?(d.css({overflow:"auto",height:e,position:"relative"}),a.data(d,"ik_select_hasScrollbar",!0),f&&(c.width(c.width()+i),d.width(d.width()+i))):a.data(d,"ik_select_hasScrollbar")&&(d.css({overflow:"",height:"auto"}),d.width(d.width()-i),c.width(c.width()-i)),c.hide()}}),a.fn.ikSelect=function(b){if(l)return this;var c=[].slice.call(arguments);return this.each(function(){if(!a.data(this,"plugin_ikSelect"))a.data(this,"plugin_ikSelect",new m(this,b));else if(typeof b=="string"){var d=a.data(this,"plugin_ikSelect");switch(b){case"reset":d.reset();break;case"hide_dropdown":d.hide_block();break;case"show_dropdown":d.show_block(),h=!0;break;case"add_options":d.add_options(c[1]);break;case"remove_options":d.remove_options(c[1]);break;case"enable":d.enable_select();break;case"disable":d.disable_select();break;case"toggle":d.toggle_select();break;case"select":d.make_selection(c[1]);break;case"set_defaults":d.set_defaults(c[1])}}})},a.ikSelect=new m,a(d).bind("click.ikSelect",function(b){!h&&g.length&&!a(b.target).parents(".ik_select").length&&(g.ikSelect("hide_dropdown"),g=a([])),h&&(h=!1)})})(jQuery,window);
